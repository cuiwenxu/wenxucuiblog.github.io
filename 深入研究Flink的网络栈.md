Flink的网络栈是组成Flink运行时模块的核心组件之一，网络栈的组成可以分为两类
- taskmanager和jobmanager之间的通信使用Akka
- taskmanager之间的网络栈使用Netty的较低层次的API

这篇博客文章是关于网络堆栈系列文章的第一篇。在下面的小节中，我们将首先对流操作符暴露的抽象进行一个高级的了解，然后详细介绍物理实现和Flink所做的各种优化。我们将简要介绍这些优化的结果以及Flink在吞吐量和延迟之间的权衡。本系列的后续博客文章将详细介绍监视和指标、调优参数和常见的anti-patterns。

# 逻辑视图
Flink的网络栈在相互通信时为子任务提供如下逻辑视图，例如keyBy()的逻辑视图
![在这里插入图片描述](https://img-blog.csdnimg.cn/5e49d0e69e4b4e50a879e8a3216e939c.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTE2MjQxNTc=,size_16,color_FFFFFF,t_70)

它抽象了以下三个概念的不同设置:

- 子任务输出类型(ResultPartitionType):
	1、流水线(有界或无界):数据一产生就向下游发送，可能是一个接一个的，作为有界或无界的记录流。
	2、blocking:只在生成完整结果时才向下游发送数据。
- 调度类型:
	1、all at once (eager):同时部署作业的所有子任务(对于流应用程序)。
	2、第一次输出即部署(惰性):只要下游任务的任何生产者生成输出，就立即部署它们。
	3、全部输出再部署:当任何或所有生产者生成了完整的输出集时，部署下游任务。
- 传输:
	1、高吞吐量:Flink不是一个一个地发送每条记录，而是将一堆记录缓冲到它的网络缓冲区中，然后一起发送。这降低了每条记录的成本，并导致更高的吞吐量。
	2、通过缓冲区超时降低延迟:通过减少发送未完全填满的缓冲区的超时，您可能会牺牲吞吐量来换取延迟。

在下面讨论网络栈物理层的部分中，我们将了解吞吐量和低延迟优化。在这一部分中，让我们更详细地介绍输出和调度类型。首先，重要的是要知道子任务输出类型和调度类型是紧密交织在一起的，这使得只有特定的组合才有效。

流水线结果分区是流样式的输出，需要一个实时的目标子任务向其发送数据。目标可以在结果产生之前或第一次输出时进行调度。批处理作业产生有界结果分区，而流作业产生无界结果。

批处理作业也可能以阻塞方式产生结果，这取决于所使用的操作符和连接模式。在这种情况下，必须首先生成完整的结果，然后才能调度接收任务。这允许批处理作业以更低的资源使用效率工作。

下表总结了有效的组合:

