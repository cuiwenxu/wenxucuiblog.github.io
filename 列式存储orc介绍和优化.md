@[TOC](列式存储orc介绍和优化)
# 列式存储　　
　　由于OLAP查询的特点，列式存储可以提升其查询性能，但是它是如何做到的呢？这就要从列式存储的原理说起，从下图中可以看到，相对于关系数据库中通常使用的行式存储，在使用列式存储时每一列的所有元素都是顺序存储的。由此特点可以给查询带来如下的优化：

- 1.查询的时候不需要扫描全部的数据，而只需要读取每次查询涉及的列，这样可以将I/O消耗降低N倍，另外可以保存每一列的统计信息(min、max、sum等)，实现部分的谓词下推。
- 2.由于每一列的成员都是同构的，可以针对不同的数据类型使用更高效的数据压缩算法，进一步减小I/O。
- 3.由于每一列的成员的同构性，可以使用更加适合CPU pipeline的编码方式，减小CPU的缓存失效。
![图一](https://img-blog.csdnimg.cn/aa50c6bb10fa4fe796fbcb3139becb82.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5bem5p6X5Y-z5p2OMDI=,size_17,color_FFFFFF,t_70,g_se,x_16)

# 合理选择分区字段以发挥orc的最大优势
`合理选择分区字段，让相似的数据尽量分到一起（原理类似rle压缩算法），这样可以提高orc的压缩效率。`
举个栗子：
用户访问产生的流量数据的最常见的重分布是按照用户id进行重分布，因为同一个用户的访问session、访问步骤id、访问设备、访问终端都可能是相同的，在存储时可获得较大的压缩率。
